<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CGPA Calculator</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>CGPA Calculator</h1>

    <div class="toggle-btn-group">
      <button id="light-mode" class="toggle-on">Light Mode</button>
      <button id="dark-mode" class="toggle-off">Dark Mode</button>
    </div>

    <!-- NEW: Grading scale selector -->
    <div style="margin-bottom: 10px;">
      <label for="grade-scale">Grading Scale:</label>
      <select id="grade-scale">
        <option value="5" selected>5-Point Scale (A=5)</option>
        <option value="4">4-Point Scale (A=4)</option>
        <option value="custom">Custom Scale</option>
      </select>
    </div>

    <form id="cgpa-form">
      <div id="course-inputs"></div>
      <button type="button" id="add-course">Add Course</button>
      <button type="button" id="calculate">Calculate CGPA</button>
      <button type="button" id="export-csv">Export to CSV</button>
      <button type="button" id="print-report">Print Report</button>
      <button type="button" id="clear-data">Clear All Data</button>
    </form>

    <div class="progress-bar">
      <div class="progress-fill" id="progress-fill"></div>
    </div>

    <div class="result" id="result">Your CGPA will appear here.</div>
  </div>

  <script>
    const addCourseBtn = document.getElementById('add-course');
    const clearDataBtn = document.getElementById('clear-data');
    const exportCsvBtn = document.getElementById('export-csv');
    const printReportBtn = document.getElementById('print-report');
    const calculateBtn = document.getElementById('calculate');
    const lightModeBtn = document.getElementById('light-mode');
    const darkModeBtn = document.getElementById('dark-mode');
    const courseInputs = document.getElementById('course-inputs');
    const result = document.getElementById('result');
    const progressFill = document.getElementById('progress-fill');
    const gradeScaleSelector = document.getElementById('grade-scale');

    let currentScale = '5';

    const gradeOptions = {
      '5': [
        { label: 'A', value: 5 },
        { label: 'B', value: 4 },
        { label: 'C', value: 3 },
        { label: 'D', value: 2 },
        { label: 'E', value: 1 },
        { label: 'F', value: 0 },
      ],
      '4': [
        { label: 'A', value: 4 },
        { label: 'B+', value: 3.5 },
        { label: 'B', value: 3 },
        { label: 'C+', value: 2.5 },
        { label: 'C', value: 2 },
        { label: 'D', value: 1 },
        { label: 'F', value: 0 },
      ]
    };

    function createGradeSelect(selected = '') {
      const select = document.createElement('select');
      select.className = 'grade';
      select.required = true;

      const defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.textContent = 'Grade';
      select.appendChild(defaultOption);

      const options = gradeOptions[currentScale] || [];
      options.forEach(opt => {
        const option = document.createElement('option');
        option.value = opt.value;
        option.textContent = opt.label;
        if (opt.value == selected) option.selected = true;
        select.appendChild(option);
      });

      return select;
    }

    function createCourseRow(code = '', grade = '', units = '') {
      const row = document.createElement('div');
      row.className = 'course-row';

      const codeInput = document.createElement('input');
      codeInput.type = 'text';
      codeInput.placeholder = 'Course Code';
      codeInput.className = 'course-code';
      codeInput.value = code;

      const gradeSelect = createGradeSelect(grade);

      const unitInput = document.createElement('input');
      unitInput.type = 'number';
      unitInput.placeholder = 'Units';
      unitInput.className = 'units';
      unitInput.min = 1;
      unitInput.max = 6;
      unitInput.value = units;

      const deleteBtn = document.createElement('button');
      deleteBtn.type = 'button';
      deleteBtn.className = 'delete-course';
      deleteBtn.textContent = 'Remove';
      deleteBtn.onclick = () => {
        row.remove();
        saveSession();
        calculateCGPA();
      };

      row.append(codeInput, gradeSelect, unitInput, deleteBtn);

      [codeInput, gradeSelect, unitInput].forEach(el => {
        el.addEventListener('input', () => {
          calculateCGPA();
          saveSession();
        });
        el.addEventListener('change', () => {
          calculateCGPA();
          saveSession();
        });
      });

      courseInputs.appendChild(row);
    }

    function calculateCGPA() {
      const grades = document.querySelectorAll('.grade');
      const units = document.querySelectorAll('.units');
      let totalPoints = 0;
      let totalUnits = 0;

      grades.forEach((grade, i) => {
        const g = parseFloat(grade.value);
        const u = parseFloat(units[i].value);
        if (!isNaN(g) && !isNaN(u)) {
          totalPoints += g * u;
          totalUnits += u;
        }
      });

      const cgpa = totalUnits ? (totalPoints / totalUnits).toFixed(2) : 0;
      result.textContent = `Your CGPA is ${cgpa}`;
      progressFill.style.width = `${(cgpa / (currentScale === '4' ? 4 : 5)) * 100}%`;
    }

    function clearData() {
      courseInputs.innerHTML = '';
      localStorage.removeItem('cgpaData');
      result.textContent = 'Your CGPA will appear here.';
      progressFill.style.width = '0';
    }

    function exportToCSV() {
      let csv = 'Course Code,Grade,Units\n';
      document.querySelectorAll('.course-row').forEach(row => {
        const code = row.querySelector('.course-code').value;
        const grade = row.querySelector('.grade').value;
        const units = row.querySelector('.units').value;
        csv += `${code},${grade},${units}\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'cgpa_data.csv';
      link.click();
    }

    function saveSession() {
      const data = [];
      document.querySelectorAll('.course-row').forEach(row => {
        data.push({
          code: row.querySelector('.course-code').value,
          grade: row.querySelector('.grade').value,
          units: row.querySelector('.units').value
        });
      });
      localStorage.setItem('cgpaData', JSON.stringify(data));
    }

    function restoreSession() {
      const saved = JSON.parse(localStorage.getItem('cgpaData') || '[]');
      saved.forEach(d => createCourseRow(d.code, d.grade, d.units));
    }

    function toggleMode(mode) {
      document.body.classList.toggle('dark-mode', mode === 'dark');
    }

    lightModeBtn.addEventListener('click', () => toggleMode('light'));
    darkModeBtn.addEventListener('click', () => toggleMode('dark'));
    addCourseBtn.addEventListener('click', () => createCourseRow());
    clearDataBtn.addEventListener('click', () => clearData());
    exportCsvBtn.addEventListener('click', () => exportToCSV());
    printReportBtn.addEventListener('click', () => window.print());
    calculateBtn.addEventListener('click', () => calculateCGPA());

    gradeScaleSelector.addEventListener('change', () => {
      currentScale = gradeScaleSelector.value;
      courseInputs.innerHTML = '';
      createCourseRow(); // Start fresh for new scale
      saveSession();
    });

    // Init
    restoreSession();
    if (!courseInputs.hasChildNodes()) createCourseRow();
  </script>
</body>
</html>
