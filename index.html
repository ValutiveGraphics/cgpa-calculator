<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CGPA Calculator</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>CGPA Calculator</h1>

    <div class="toggle-btn-group">
      <button id="light-mode" class="toggle-on">Light Mode</button>
      <button id="dark-mode" class="toggle-off">Dark Mode</button>
    </div>

    <form id="cgpa-form">
      <div id="course-inputs"></div>
      <button type="button" id="add-course">Add Course</button>
      <button type="button" id="calculate">Calculate CGPA</button>
      <button type="button" id="export-csv">Export to CSV</button>
      <button type="button" id="print-report">Print Report</button>
      <button type="button" id="clear-data">Clear All Data</button>
    </form>

    <div class="progress-bar">
      <div class="progress-fill" id="progress-fill"></div>
    </div>

    <div class="result" id="result">Your CGPA will appear here.</div>
  </div>

  <script>
    const addCourseBtn = document.getElementById('add-course');
    const clearDataBtn = document.getElementById('clear-data');
    const exportCsvBtn = document.getElementById('export-csv');
    const printReportBtn = document.getElementById('print-report');
    const calculateBtn = document.getElementById('calculate');
    const lightModeBtn = document.getElementById('light-mode');
    const darkModeBtn = document.getElementById('dark-mode');
    const courseInputs = document.getElementById('course-inputs');
    const result = document.getElementById('result');
    const progressFill = document.getElementById('progress-fill');

    function createCourseRow(code = '', grade = '', units = '') {
      const row = document.createElement('div');
      row.className = 'course-row';
      row.innerHTML = `
        <input type="text" placeholder="Course Code" class="course-code" value="${code}" required />
        <select class="grade" required>
          <option value="">Grade</option>
          <option value="5" ${grade === '5' ? 'selected' : ''}>A</option>
          <option value="4" ${grade === '4' ? 'selected' : ''}>B</option>
          <option value="3" ${grade === '3' ? 'selected' : ''}>C</option>
          <option value="2" ${grade === '2' ? 'selected' : ''}>D</option>
          <option value="1" ${grade === '1' ? 'selected' : ''}>E</option>
          <option value="0" ${grade === '0' ? 'selected' : ''}>F</option>
        </select>
        <input type="number" placeholder="Units" class="units" min="1" max="6" value="${units}" required />
        <button type="button" class="delete-course">Remove</button>
      `;

      row.querySelector('.delete-course').onclick = () => {
        row.remove();
        saveSession();
        calculateCGPA();
      };

      ['input', 'change'].forEach(evt => {
        row.addEventListener(evt, () => {
          calculateCGPA();
        });
      });

      courseInputs.appendChild(row);
    }

    function calculateCGPA() {
      const grades = document.querySelectorAll('.grade');
      const units = document.querySelectorAll('.units');
      let totalPoints = 0;
      let totalUnits = 0;

      grades.forEach((grade, i) => {
        const g = parseFloat(grade.value);
        const u = parseFloat(units[i].value);
        if (!isNaN(g) && !isNaN(u)) {
          totalPoints += g * u;
          totalUnits += u;
        }
      });

      const cgpa = totalUnits ? (totalPoints / totalUnits).toFixed(2) : 0;
      result.textContent = `Your CGPA is ${cgpa}`;
      progressFill.style.width = `${(cgpa / 5) * 100}%`;
    }

    function clearData() {
      courseInputs.innerHTML = '';
      localStorage.removeItem('cgpaData');
      result.textContent = 'Your CGPA will appear here.';
      progressFill.style.width = '0';
    }

    function exportToCSV() {
      let csv = 'Course Code,Grade,Units\n';
      document.querySelectorAll('.course-row').forEach(row => {
        const code = row.querySelector('.course-code').value;
        const grade = row.querySelector('.grade').value;
        const units = row.querySelector('.units').value;
        csv += `${code},${grade},${units}\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'cgpa_data.csv';
      link.click();
    }

    function saveSession() {
      const data = [];
      document.querySelectorAll('.course-row').forEach(row => {
        data.push({
          code: row.querySelector('.course-code').value,
          grade: row.querySelector('.grade').value,
          units: row.querySelector('.units').value
        });
      });
      localStorage.setItem('cgpaData', JSON.stringify(data));
    }

    function restoreSession() {
      const saved = JSON.parse(localStorage.getItem('cgpaData') || '[]');
      saved.forEach(d => createCourseRow(d.code, d.grade, d.units));
    }

    function toggleMode(mode) {
      document.body.classList.toggle('dark-mode', mode === 'dark');
    }

    lightModeBtn.addEventListener('click', () => toggleMode('light'));
    darkModeBtn.addEventListener('click', () => toggleMode('dark'));
    addCourseBtn.addEventListener('click', () => createCourseRow());
    clearDataBtn.addEventListener('click', () => clearData());
    exportCsvBtn.addEventListener('click', () => exportToCSV());
    printReportBtn.addEventListener('click', () => window.print());
    calculateBtn.addEventListener('click', () => calculateCGPA());

    // Init
    restoreSession();
    createCourseRow();
  </script>
</body>
</html>
